# Production Line Scheduler

A C++ application for scheduling and managing automated production line workflows in laboratory environments. The system supports various workflow types including nucleic acid testing, library preparation, RNA processing, and synthesis protocols.

## Overview

The Production Line Scheduler is designed to manage complex laboratory workflows by:
- Coordinating multiple machines and instruments
- Managing reagent allocation and container placement
- Scheduling workflow execution with dependency management
- Providing real-time monitoring through WebSocket interface
- Supporting both local testing and production modes

## Prerequisites

- **CMake** 3.5 or higher
- **C++17** compatible compiler (GCC/Clang)
- **nlohmann/json** 3.2.0 or higher
- **Boost** libraries
- **spdlog** for logging
- **fmt** for string formatting
- **libmodbus** for Modbus communication
- **magic-enum** for enum operations
- **mbedtls** for SSL support (optional)

## Building the Project

### Manual CMake Build
```bash
mkdir build && cd build
cmake ..
make
```

## Configuration

### 1. Reagent Configuration

Before running the application, you must configure reagents in the JSON configuration files located in the `config/` directory. Use the default `reagents.json` if you are not sure.

#### Reagent File Structure

The reagent configuration files (e.g., `reagents.json`, `reagents_library.json`) contain:

**Carriers Section:**
```json
{
    "carriers": [
        {
            "name": "Reaction_Carrier",
            "machine": "FLUORESCENCE",
            "machineArea": "SAMPLE_AREA",
            "type": "STRIP_TUBE",
            "is_consume": true
        }
    ]
}
```

**Tubes Section:**
```json
{
    "tubes": [
        {
            "type": "STRIP_TUBE",
            "name": "Reaction_1_Sample",
            "label": "Sample 1",
            "machine": "FLUORESCENCE",
            "machineArea": "SAMPLE_AREA",
            "AreaIndex": 0
        }
    ]
}
```

**Reagents Section:**
```json
{
    "reagents": [
        {
            "reagent": "Sample1-1",
            "volume": 5,
            "tube": "Reaction_1_Sample",
            "tube_type": "STRIP_TUBE",
            "tube_index": 0
        }
    ]
}
```

### 2. Protocol Flow Configuration

Protocol flow files (e.g., `protocol_flow.json`) define the sequence of operations:

```json
{
    "protocol_start_time": "2025-08-26T14:41:10.631034",
    "steps": [
        {
            "id": 1,
            "action": "container_allocate",
            "parameters": {
                "container_index": 1000,
                "container_label": "waste",
                "container_type": "P50K"
            }
        }
    ]
}
```

This is automatically generated by AutoDNA-python.

## Running the Application

### Web Mode (Default)

Run the application with WebSocket support for real-time monitoring:

```bash
./build/bin/main_web /path/to/config/directory
```

Example:
```bash
./build/bin/main_web ./config
```

### Other Modes

- **Local Web Mode**: `./build/bin/main_local_web` - Local testing with web interface. You should run `./build/bin/main_server` first.

### Command Line Arguments

The application accepts one optional argument:
- **Config Directory Path**: Path to the directory containing your configuration files

If no path is provided, the application will use default configuration paths.

## Web Interface

When running in web mode, the application provides:
- Real-time workflow status monitoring
- WebSocket communication for live updates
- Log streaming and visualization

The web server typically runs on port 8080.

## Logging

The application generates detailed logs in the `logs/` directory with timestamps:
- Console output with color-coded log levels
- File logs with detailed execution information
- Error tracking and debugging information

## Project Structure

```
ProductionLineScheduler/
├── config/                 # Configuration files
│   ├── reagents_*.json     # Reagent configurations
│   └── protocol_flow_*.json # Protocol definitions
├── src/                    # Source code
│   ├── main_scheduler.cpp  # Main application entry point
│   ├── server/             # WebSocket and scheduler components
│   ├── machine/            # Machine management
│   ├── procedure/          # Workflow and step definitions
│   └── modbus/             # Modbus communication
├── include/                # Header files
├── scripts/                # Python analysis and testing scripts
├── build/                  # Build output directory
└── logs/                   # Application logs
```


### Common Issues

1. **Configuration Path**: Ensure the config directory path is correct and contains all required files
2. **Dependencies**: Verify all required libraries are installed
3. **Permissions**: Check file permissions for config files and log directories
4. **Port Conflicts**: Ensure port 8080 is available for web mode


## License

This project is part of a production line automation system. Please refer to your organization's licensing terms.
